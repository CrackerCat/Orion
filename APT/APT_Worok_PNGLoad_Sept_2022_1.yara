rule APT_Worok_PNGLoad_Sept_2022_1 : pngload dotnet loader worok
{
   meta:
        description = "Detect the c# loader PNGLoad used by the Worok group"
        author = "Arkbird_SOLG"
        reference = "https://www.welivesecurity.com/2022/09/06/worok-big-picture/"
        date = "2022-09-06"
        // from eset article
        hash1 = "abf4924189449f138e2c317801980bf678fcf41dc3439da1165b0e0bc0338b5e"
        // from retrohunt
        hash2 = "69f8f652fc9bd4443121e9b1fe54a1d8a980736455ba448c9b0c4764fca65a72"
        hash3 = "95d2d272198c709b90d2bd49d84728f4bb58143063e1e785e747742d42970336"
        tlp = "clear"
        adversary = "Worok"
   strings:
        $s1 = { 05 00 30 00 00 00 06 00 00 11 2b 09 28 [4] 14 16 9a 26 16 2d f9 72 a6 01 00 70 6f 5e 00 00 0a 26 02 28 5f 00 00 0a 0a 28 60 00 00 0a 06 16 06 8e 69 6f 61 00 00 }
        $s2 = { 1b 30 04 00 07 01 00 00 11 00 00 11 2b 09 28 [4] 14 16 9a 26 16 2d f9 02 74 47 00 00 01 6f 73 00 00 0a 28 11 00 00 0a 39 11 00 00 00 02 74 47 00 00 01 6f 73 00 00 0a 0a dd d1 00 00 00 dd 06 00 00 00 26 dd 00 00 00 00 02 74 47 00 00 01 6f 74 00 00 0a 6f 75 00 00 0a 6f 18 00 00 0a 72 c4 02 00 70 72 a4 01 00 70 6f 76 00 00 0a 28 11 00 00 0a 39 2a 00 00 00 02 74 47 00 00 01 6f 74 00 00 0a 6f 75 00 00 0a 6f 18 00 00 0a 72 c4 02 00 70 72 a4 01 00 70 6f 76 00 00 0a 0a dd 6e 00 00 00 dd 06 00 00 00 26 dd 00 00 00 00 02 6f ?? 00 00 0a 72 d6 02 00 70 6f 77 00 00 0a 02 16 8d 18 00 00 01 6f 78 00 00 0a 6f 18 00 00 0a 28 11 00 00 0a 39 27 00 00 00 02 6f ?? 00 00 0a 72 d6 02 00 70 6f 77 00 00 0a 02 16 8d 18 00 00 01 6f 78 00 00 0a 6f 18 00 00 0a 0a dd 11 00 00 00 dd 06 00 00 00 26 dd 00 00 00 00 72 a4 01 00 70 2a 06 2a 00 01 28 00 00 00 00 0e 00 2b 39 00 06 18 00 00 01 00 00 3f 00 5d 9c 00 06 18 00 00 01 00 00 a2 00 57 f9 00 06 18 00 00 01 }
        $s3 = { 06 00 74 00 00 00 0f 00 00 11 2b 09 28 [4] 14 16 9a 26 16 2d f9 20 5d 00 00 01 28 ce 00 00 06 28 4f 00 00 0a 72 da 01 00 70 18 8d 40 00 00 01 0a 06 16 20 48 00 00 01 28 ce 00 00 06 28 4f 00 00 0a a2 06 17 20 40 00 00 01 28 ce 00 00 06 28 4f 00 00 0a a2 06 28 6a 00 00 0a 14 18 8d 18 00 00 01 0b 07 16 02 8c 48 00 00 01 a2 07 17 03 a2 07 6f 6b 00 00 0a 74 45 }
        $s4 = { 04 00 53 00 00 00 00 00 00 00 28 2f 00 00 06 28 d6 00 00 06 28 cb 00 00 06 1e 8d 1e 00 00 01 25 d0 05 00 00 04 28 48 00 00 0a 80 01 00 00 04 20 70 00 00 00 28 25 00 00 06 80 02 00 00 04 20 ?? 00 00 00 28 25 00 00 06 80 03 00 00 04 20 ?? 01 00 00 28 25 00 00 06 80 04 }
    condition:
        uint16(0) == 0x5A4D and filesize > 20KB and all of ($s*) 
}
