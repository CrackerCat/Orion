rule APT_APT28_CredoMap_Jun_2022_1 : credomap apt28
{
   meta:
        description = "Detect the CredoMap stealer used by APT28 group"
        author = "Arkbird_SOLG"
        reference = "https://blog.malwarebytes.com/threat-intelligence/2022/06/russias-apt28-uses-fear-of-nuclear-war-to-spread-follina-docs-in-ukraine/"
        date = "2022-06-22"
        // V1
        hash1 = "39d242660c6d5dbe97d5725bbfed0f583344d18840ccd902fffdd71af12e20ec"
        hash2 = "710faabf217a5cd3431670558603a45edb1e01970f2a8710514c2cc3dd8c2424"
        // V2
        hash3 = "2318ae5d7c23bf186b88abecf892e23ce199381b22c8eb216ad1616ee8877933"
        tlp = "Clear"
        adversary = "APT28"
   strings:
        $s1 = { 00 20 00 02 00 00 8d ?? 00 00 01 0a 28 ?? 00 00 0a 1b 8d ?? 00 00 01 25 16 72 [2] 00 70 a2 25 17 02 a2 25 18 72 [2] 00 70 a2 25 19 03 a2 25 1a 72 [2] 00 70 a2 28 ?? 00 00 0a 6f ?? 00 00 0a 0b 7e ?? 00 00 04 07 16 07 8e 69 6f ?? 00 00 0a 00 7e ?? 00 00 04 06 16 20 00 02 00 00 6f ?? 00 00 0a 26 }
        $s2 = { 00 28 ?? 00 00 0a 6f ?? 00 00 0a 28 ?? 00 00 0a 6f ?? 00 00 0a 28 ?? 00 00 0a 0a 7e ?? 00 00 04 }
        $s3 = { 73 ?? 00 00 0a 0a 06 72 [2] 00 70 02 28 ?? 00 00 0a 6f ?? 00 00 0a 00 06 17 6f ?? 00 00 0a 00 06 17 6f ?? 00 00 0a 00 06 72 [2] 00 70 6f ?? 00 00 0a 00 06 28 ?? 00 00 0a 26 }
        $s4 = { 1f 1c 28 ?? 00 00 0a 72 [2] 00 70 28 ?? 00 00 0a 28 ?? 00 00 0a 16 fe 01 13 05 11 05 2c 0c 72 [2] 00 70 13 06 38 63 02 00 00 73 ?? 00 00 0a 0a 2b 32 00 00 1f 1c 28 ?? 00 00 0a 72 [2] 00 70 28 ?? 00 00 0a 72 ?? 01 00 70 17 28 ?? 00 00 0a 00 de 16 26 00 20 10 27 00 00 28 ?? 00 00 0a 00 00 de 00 00 17 13 07 2b c9 72 ?? 01 00 70 73 ?? 00 00 0a 0b 07 6f ?? 00 00 0a 00 72 [2] 00 70 07 73 ?? 00 00 0a 0c 08 6f ?? 00 00 0a 0d 38 dd 01 00 00 00 09 72 [2] 00 70 6f ?? 00 00 0a 74 06 00 00 1b 13 08 72 [2] 00 70 28 ?? 00 00 0a 72 [2] 00 70 28 ?? 00 00 0a 28 ?? 00 00 0a 13 09 11 09 28 ?? 00 00 0a 72 ?? 00 00 70 6f ?? 00 00 0a 72 ?? 00 00 70 6f ?? 00 00 0a 6f ?? 00 00 0a 13 09 11 09 28 ?? 00 00 0a 1b 28 01 00 00 2b 28 02 00 00 2b 14 17 28 ?? 00 00 0a 13 0a 11 08 73 ?? 00 00 0a 13 0b 11 0b 73 ?? 00 00 0a 13 0c 00 11 0c 19 6f ?? 00 00 0a 13 0d 11 0c 1f 0c 6f ?? 00 00 0a 13 0e 73 ?? 00 00 0a 73 ?? 00 00 0a 13 0f 11 0a 73 ?? 00 00 0a 20 80 00 00 00 11 0e 73 ?? 00 00 0a 13 10 11 0f 16 11 10 6f ?? 00 00 0a 00 11 0c 11 08 8e 69 6f ?? 00 00 0a 13 11 11 0f 11 11 8e 69 6f ?? 00 00 0a 8d ?? 00 00 01 13 12 00 11 0f 11 11 16 11 11 8e 69 11 12 16 6f ?? 00 00 0a 13 16 11 0f 11 12 11 16 6f ?? 00 00 0a 26 00 de 05 26 00 00 de 00 28 ?? 00 00 0a 11 12 6f ?? 00 00 0a 13 13 09 72 [2] 00 70 6f ?? 00 00 0a 6f ?? 00 00 0a 13 14 09 72 [2] 00 70 6f ?? 00 00 0a 13 15 06 11 14 6f ?? 00 00 0a 13 17 11 17 2c 52 00 06 13 18 11 14 13 19 11 18 11 19 1b 8d ?? 00 00 01 25 16 11 18 11 19 6f ?? 00 00 0a a2 25 17 11 15 2d 03 14 2b 07 11 15 6f ?? 00 00 0a a2 25 18 72 [2] 00 70 a2 25 19 11 13 a2 25 1a 72 [2] 00 70 a2 28 ?? 00 00 0a 6f ?? 00 00 0a 00 00 2b 2a 00 06 11 14 11 15 2d 03 14 2b 07 11 15 6f ?? 00 00 0a 72 [2] 00 70 11 13 72 [2] 00 70 28 ?? 00 00 0a 6f ?? 00 00 0a 00 00 00 de 0d 11 0c 2c 08 11 0c 6f ?? 00 00 0a 00 dc de 0d 11 0b 2c 08 11 0b 6f ?? 00 00 0a 00 dc 00 09 6f ?? 00 00 0a 13 1a 11 1a 3a 14 fe ff ff 06 28 ?? 00 00 0a 13 04 11 04 13 06 2b 00 11 }
   condition:
       uint16(0) == 0x5A4D and all of ($s*)
}
